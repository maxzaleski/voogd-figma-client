!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Voogd=e():t.Voogd=e()}(global,(function(){return function(t){var e={};function r(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e){t.exports=require("axios")},function(t,e,r){t.exports={HttpBadRequestError:r(5),HttpForbiddenError:r(6),HttpNotFoundError:r(7),AssetExportError:r(8)}},function(t,e,r){t.exports={Client:r(3)}},function(t,e,r){const o=r(4),n=r(10);t.exports=class{constructor(t){this.personalAccessToken=t,this.figmaWrapper_=new o(t),this.exporter_=new n(this.figmaWrapper_)}getDocument(t,e){const r=this.figmaWrapper_.getFileByFileKey(t);if(!e)return r;r.then(t=>e(t,void 0)).catch(t=>e(void 0,t))}getProjects(t,e){const r=this.figmaWrapper_.getProjectsByTeamId(t);if(!e)return r;r.then(t=>e(t,void 0)).catch(t=>e(void 0,t))}getProjectFiles(t,e){const r=this.figmaWrapper_.getProjectFilesByProjectId(t);if(!e)return r;r.then(t=>e(t,void 0)).catch(t=>e(void 0,t))}getTeamStyles(t,e,r){const o=this.figmaWrapper_.getStylesByTeamId(t,e);if(!r)return o;o.then(t=>r(t,void 0)).catch(t=>r(void 0,t))}exportAssets(t,e,r){const o=this.exporter_.exportAssetByNodeIds(t,e);if(!r)return o;o.then(()=>r(void 0)).catch(t=>r(t))}}},function(t,e,r){const o=r(0).default,{HttpBadRequestError:n,HttpForbiddenError:i,HttpNotFoundError:s}=r(1),{mapDocument:a,mapFiles:c,mapStyles:u}=r(9);t.exports=class{constructor(t){this.personalAccessToken_=t}async getFileByFileKey(t){const e=await this.fetchFromFigmaAPI(`/files/${t}`);return a(e.document)}async getProjectsByTeamId(t){return this.fetchFromFigmaAPI(`/teams/${t}/projects`)}async getProjectFilesByProjectId(t){const e=await this.fetchFromFigmaAPI(`/projects/${t}/files`);return c(e.files)}async getAssetsByFileKeyAndNodeIDs(t,e=[],r){const o=`/images/${t}/?ids=${e.join(",")}&format=${r.toLowerCase()}`;return(await this.fetchFromFigmaAPI(o)).images}async getStylesByTeamId(t,e=[]){const r=await this.fetchFromFigmaAPI(`/teams/${t}/styles?page_size=10000`),o=u(r.meta.styles);return e.length?o.filter(t=>e.includes(t.fileKey)):o}async fetchFromFigmaAPI(t){try{const e=`https://api.figma.com/v1${t}`,r={headers:{"X-FIGMA-TOKEN":this.personalAccessToken_}};return(await o.get(e,r)).data}catch(t){const{status:e}=t.response;if(400===e)throw new n;if(403===e)throw new i;if(404===e)throw new s}}}},function(t,e){class r extends Error{constructor(){super("400 - Bad request: Verify arguments"),this.name="HttpBadRequestError"}}t.exports=r},function(t,e){class r extends Error{constructor(){super("403 - Forbidden: Token is invalid"),this.name="HttpForbiddenError"}}t.exports=r},function(t,e){class r extends Error{constructor(){super("404 - not found: No result. Verify arguments"),this.name="HttpNotFoundError"}}t.exports=r},function(t,e){class r extends Error{constructor(t){super(`Error during export of assets: ${t}`),this.name="AssetExportError"}}t.exports=r},function(t,e){function r(t,e,r){if(!t||Array.isArray(t)&&!t.length)return;return t.map(t=>e(t,r)).filter(t=>null!=t)}function o(t){return{id:t.id,handle:t.handle,pictureUrl:t.img_url}}function n(t){return{width:t.absoluteBoundingBox.width,height:t.absoluteBoundingBox.height}}function i(t){return{topLeftCorner:t[0],topRightCorner:t[1],bottomRightCorner:t[2],bottomLeftCorner:t[3]}}function s(t){const e=["r","g","b"].map(e=>Math.round(255*t[e])),r=e.map(t=>{const e=t.toString(16);return e.length<2?`0${e}`:e}).join("").toUpperCase();return{r:e[0],g:e[1],b:e[2],a:t.a||1,hex:`#${r}`}}function a(t){return{type:t.type,radius:t.radius,offset:t.offset,colour:s(t.color)}}function c(t){return{pattern:t.pattern,sectionSize:t.sectionSize,colour:s(t.colour),alignment:t.alignment,gutterSize:t.gutterSize,offset:t.offset,count:t.count}}function u(t){return{position:t.position,colour:s(t.color)}}function l(t,e){return{colour:s(t.color),strokeWeight:e.strokeWeight,strokeCap:e.strokeCap,strokeJoin:e.strokeJoin,strokeDashes:e.strokeDashes,strokeMiterAngle:e.strokeMiterAngle,strokeGeometry:e.strokeGeometry,strokeAlign:e.strokeAlign}}function p(t){return{textAlignHorizontal:t.textAlignHorizontal,textAlignVertical:t.textAlignVertical}}function f(t){return{fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontSize:t.fontSize,fontPostScriptName:t.fontPostScriptName}}function d(t){return{lineHeightPx:t.lineHeightPx,lineHeightPercent:t.lineHeightPercent,lineHeightUnit:t.lineHeightUnit}}function g(t){return{type:t.type,opacity:t.opacity||1,colour:"IMAGE"!==t.type?s(t.color):void 0,gradientHandlePositions:t.gradientHandlePositions,gradientStops:r(t.gradientStops,u),imageRef:t.imageRef}}function m(t){return{font:f(t),paragraphSpacing:t.paragraphSpacing,paragraphIndent:t.paragraphIndent,italic:t.italic,textCase:t.textCase,textDecoration:t.textDecoration,textAlign:p(t),letterSpacing:t.letterSpacing,fills:r(t.fills,g),lineHeight:d(t)}}function y(t){return{id:t.id,name:t.name,type:t.type}}function h(t){return{...y(t),exportSettings:t.exportSettings,opacity:t.opacity,dimensions:n(t),effects:r(t.effects,a)}}function x(t){return{...h(t),fills:r(t.fills,g),fillGeometry:t.fillGeometry,strokes:r(t.strokes,l,t)}}function A(t){switch(t.type){case"FRAME":case"GROUP":return b(t);case"STAR":case"LINE":case"ELLIPSE":case"REGULAR_POLYGON":return x(t);case"TEXT":return{...x(t),value:t.characters,style:m(t.style)};case"RECTANGLE":return{...x(t),borderRadius:t.cornerRadius,borderRadii:r(t.rectangleCornerRadii,i)}}}function b(t){return{...h(t),backgroundColour:t.backgroundColour,background:r(t.background,g),layoutGrids:r(t.layoutGrid,c),layers:r(t.children,A)}}function k(t){const e=t.children.map(t=>{if("FRAME"===t.type||"GROUP"===t.type)return b(t)}).filter(t=>null!=t);return{...y(t),backgroundColour:s(t.backgroundColor),exportSettings:t.exportSettings,layers:e}}t.exports={mapDocument:function(t){return{id:t.id,name:t.name,type:t.type,canvasses:r(t.children,k)}},mapFiles:function(t){return t.map(t=>(function(t){return{key:t.key,name:t.name,thumbnailUrl:t.thumbnail_url,lastModified:t.last_modified}})(t))},mapStyles:function(t){return t.map(t=>(function(t){return{key:t.key,fileKey:t.file_key,nodeId:t.node_id,type:t.style_type,name:t.name,description:t.description,user:o(t.user)}})(t))}}},function(t,e,r){const o=r(0).default,n=r(11),{AssetExportError:i}=r(1);t.exports=class{constructor(t){this.api_=t,this.defaultOutDir_="exported_assets"}async exportAssetByNodeIds(t,e){const r=e.assetRefs.map(t=>t.id),o=e.format||"PNG",n=await this.api_.getAssetsByFileKeyAndNodeIDs(t,r,o);try{const t=this.checkForDirectory(e.outDir).mapAssets(n,e.assetRefs).map(t=>this.writeToDisk(t,e));return void await Promise.all(t)}catch(t){throw new i(t)}}async writeToDisk(t,e){const r=`${e.outDir||this.defaultOutDir_}/${t.exportAs}.${e.format.toLowerCase()}`,i=n.createWriteStream(r),s=await o.get(t.url,{strictSSL:!1,responseType:"stream"});return new Promise(t=>{s.data.pipe(i).on("error",t=>{throw t}).on("finish",()=>{i.end(),t()})})}checkForDirectory(t){const e=t||this.defaultOutDir_;return n.existsSync(e)||n.mkdirSync(e),this}mapAssets(t,e){return Object.keys(t).map(r=>{return{exportAs:e.find(t=>t.id===r).exportAs,url:t[r]}})}}},function(t,e){t.exports=require("fs")}])}));